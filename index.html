<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶∏‡ßç‡¶¨‡¶∞‡ßç‡¶£‡ßá‡¶∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans Bengali', sans-serif; background: #f3c623; text-align: center; padding: 15px; }
        .calculator {
            background: #ffffff; padding: 15px; width: 90%; max-width: 340px; margin: auto; border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        h2 { font-size: 20px; margin-bottom: 10px; border-bottom: 2px solid #f3c623; padding-bottom: 5px; color: #333; }
        input, button {
            width: 100%; padding: 8px; margin: 5px 0; border-radius: 6px; border: 1px solid #ddd; font-size: 14px;
        }
        button { background: #f3c623; color: white; cursor: pointer; border: none; font-weight: bold; }
        button:hover { background: #d4a317; }
        #result, #finalResult { margin-top: 10px; font-size: 16px; font-weight: bold; color: #333; }
        .btn-row { display: flex; justify-content: space-between; gap: 6px; flex-wrap: wrap; }
        .btn-row button { flex: 1; }
    </style>
</head>
<body>
    <div class="calculator">
        <h2>üî∂ Gold & Silver Price Calculator for BD üî∂</h2>

        <input type="number" id="customValue" placeholder="‡¶∏‡ßç‡¶¨‡¶∞‡ßç‡¶£‡ßá‡¶∞ ‡¶¶‡¶æ‡¶Æ (‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶≠‡¶∞‡¶ø)" oninput="updateResults()" step="any" min="0">
        <input type="number" id="optionalValue" placeholder="‡¶Æ‡¶ú‡ßÅ‡¶∞‡¶ø (‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶≠‡¶∞‡¶ø)" oninput="calculateResults()" step="any" min="0">
        <input type="number" id="input1" placeholder="‡¶≠‡¶∞‡¶ø" min="0" oninput="calculateResults()">
        <input type="number" id="input2" placeholder="‡¶Ü‡¶®‡¶æ" min="0" oninput="calculateResults()">
        <input type="number" id="input3" placeholder="‡¶∞‡¶§‡ßç‡¶§‡¶ø" min="0" oninput="calculateResults()">
        <input type="number" id="input4" placeholder="‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü" min="0" oninput="calculateResults()">
        <input type="number" id="gramInput" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ (‡¶Ø‡ßá‡¶Æ‡¶® 11.664)" step="any" oninput="convertFromGram()">

        <div class="btn-row">
            <button onclick="clearFields()">üóë ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞</button>
            <button onclick="downloadReceipt()">üßæ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
        </div>
        <div class="btn-row">
            <button onclick="copyReceipt()">üìã ‡¶ï‡¶™‡¶ø</button>
            <button onclick="shareReceipt()">üì§ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞</button>
        </div>

        <div id="result"></div>
        <div id="finalResult">‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ = ‡ß≥‡ß¶</div>
    </div>

    <script>
        const GRAM_PER_VORI = 11.664;

        let result1 = 0, totalWage = 0, points = 0, receiptContent = "";

        function updateResults() {
            const customValue = parseFloat(document.getElementById("customValue").value) || 0;
            result1 = customValue / 960;
            calculateResults();
        }

        function calculateResults() {
            let input1 = parseFloat(document.getElementById('input1').value) || 0;
            let input2 = parseFloat(document.getElementById('input2').value) || 0;
            let input3 = parseFloat(document.getElementById('input3').value) || 0;
            let input4 = parseFloat(document.getElementById('input4').value) || 0;
            let optionalValue = parseFloat(document.getElementById('optionalValue').value) || 0;

            // ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶ó‡¶£‡¶®‡¶æ (‡¶≠‡¶∞‡¶ø/‡¶Ü‡¶®‡¶æ/‡¶∞‡¶§‡ßç‡¶§‡¶ø/‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶•‡ßá‡¶ï‡ßá)
            points = (input1 * 960) + (input2 * 60) + (input3 * 10) + input4;
            totalWage = (optionalValue / 960) * points;

            // ‡¶≠‡¶∞/‡¶Ü‡¶®‡¶æ/‡¶∞‡¶§‡ßç‡¶§‡¶ø/‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶≠‡¶æ‡¶ó ‡¶ï‡¶∞‡¶æ (‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
            let finalVori = Math.floor(points / 960);
            let remainingPoints = points % 960;
            let finalAna = Math.floor(remainingPoints / 60);
            remainingPoints %= 60;
            // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá finalRotti ‡¶ì finalPoint fractional ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá ‡¶Ø‡¶¶‡¶ø points fractional ‡¶π‡ßü
            let finalRotti = Math.floor(remainingPoints / 10);
            let finalPoint = remainingPoints % 10;

            // ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡¶ï‡ßá ‡¶¶‡ßÅ‡¶á ‡¶¶‡¶∂‡¶Æ‡¶ø‡¶ï ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶∏‡ßÄ‡¶Æ‡¶æ‡¶¨‡¶¶‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
            let displayPoint = Number(finalPoint).toFixed(2);

            // ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨
            let gramResult = (points / 960) * GRAM_PER_VORI;

            document.getElementById("result").innerHTML = `üìè ‡¶ì‡¶ú‡¶®: ${finalVori} ‡¶≠‡¶∞‡¶ø, ${finalAna} ‡¶Ü‡¶®‡¶æ, ${finalRotti} ‡¶∞‡¶§‡ßç‡¶§‡¶ø, ${displayPoint} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü | ‚ú® ${gramResult.toFixed(3)} g`;
            let finalResult = (result1 * points) + totalWage;
            document.getElementById("finalResult").innerText = `üü¢ ‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ = ‡ß≥${finalResult.toFixed(2)}`;
        }

        function convertFromGram() {
            const gramValue = parseFloat(document.getElementById('gramInput').value) || 0;
            if (gramValue <= 0) {
                // ‡¶Ø‡¶¶‡¶ø ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶¨‡¶æ ‡¶∂‡ßÇ‡¶®‡ßç‡¶Ø ‡¶π‡ßü, ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶®
                return;
            }

            // ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‚Üí ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶®‡¶≠‡¶æ‡¶∞‡ßç‡¶∏‡¶®
            // points may be fractional here
            points = (gramValue / GRAM_PER_VORI) * 960;

            // ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‚Üí ‡¶≠‡¶∞‡¶ø/‡¶Ü‡¶®‡¶æ/‡¶∞‡¶§‡ßç‡¶§‡¶ø/‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü (fractional-safe)
            let vori = Math.floor(points / 960);
            let rem = points - (vori * 960); // fractional remainder
            let ana = Math.floor(rem / 60);
            rem = rem - (ana * 60);
            let rotti = Math.floor(rem / 10);
            let point = rem - (rotti * 10); // point can be fractional

            // ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶¨‡¶ï‡ßç‡¶∏‡ßá ‡¶Ö‡¶ü‡ßã ‡¶´‡¶ø‡¶≤ (point-‡¶è ‡¶õ‡ßã‡¶ü ‡¶¶‡¶∂‡¶Æ‡¶ø‡¶ï ‡¶∞‡¶æ‡¶ñ‡¶≤‡ßá internal value ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡¶¨‡ßá)
            document.getElementById('input1').value = vori;
            document.getElementById('input2').value = ana;
            document.getElementById('input3').value = rotti;
            // input4 (point) ‡¶è ‡¶™‡ßÅ‡¶∞‡ßã ‡¶ï‡ßã‡¶°‡ßá‡¶∞ ‡¶Æ‡¶§ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶¶‡¶∂‡¶Æ‡¶ø‡¶ï ‡¶∞‡¶æ‡¶ñ‡¶≤‡ßá UI ‡¶è ‡¶Ö‡¶®‡ßá‡¶ï ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶¨‡ßá,
            // ‡¶§‡¶æ‡¶á ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ input4-‡¶è‡¶ì 2 ‡¶¶‡¶∂‡¶Æ‡¶ø‡¶ï ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßã, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ internal 'points' ‡¶ß‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡¶õ‡¶ø
            document.getElementById('input4').value = Number(point).toFixed(2);

            // ‡¶è‡¶ñ‡¶® ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡¶¨ ‚Äî calculateResults() points ‡¶ï‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶£‡ßü ‡¶ï‡¶∞‡ßá ‡¶®‡ßá‡¶¨‡ßá
            // ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ calculateResults() ‡¶è‡¶ñ‡¶® input4 ‡¶•‡ßá‡¶ï‡ßá full numeric value ‡¶®‡ßá‡¶¨‡ßá (‡¶Ø‡¶æ toFixed ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶Ç ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá)
            // ‡¶Ø‡¶æ‡¶§‡ßá internal consistency ‡¶•‡¶æ‡¶ï‡ßá, ‡¶Ü‡¶Æ‡¶∞‡¶æ input4 ‡¶ï‡ßá parseFloat ‡¶ï‡¶∞‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø
            calculateResults();
        }

        function clearFields() {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                document.querySelectorAll('input').forEach(input => input.value = '');
                document.getElementById("result").innerHTML = "";
                document.getElementById("finalResult").innerText = '‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ = ‡ß≥‡ß¶';
                // reset internal variables
                points = 0;
                totalWage = 0;
                result1 = 0;
            }
        }

        function buildReceipt() {
            let customValue = parseFloat(document.getElementById("customValue").value) || 0;
            let optionalValue = parseFloat(document.getElementById("optionalValue").value) || 0;
            let currentDate = new Date().toLocaleString('bn-BD', { dateStyle: 'full', timeStyle: 'short' });

            let finalVori = Math.floor(points / 960);
            let remainingPoints = points % 960;
            let finalAna = Math.floor(remainingPoints / 60);
            remainingPoints %= 60;
            let finalRotti = Math.floor(remainingPoints / 10);
            let finalPoint = remainingPoints % 10;
            let gramResult = (points / 960) * GRAM_PER_VORI;
            let finalResultText = document.getElementById('finalResult').innerText;

            // receipt ‡¶è‡¶ì ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡ßÅ‡¶á ‡¶¶‡¶∂‡¶Æ‡¶ø‡¶ï ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ö‡ßç‡¶õ‡¶ø
            let receiptPoint = Number(finalPoint).toFixed(2);

            receiptContent = `üî∂ Charigram Gold Market üî∂\n-----------------------------------\nüìÖ ‡¶∞‡¶∏‡¶ø‡¶¶ ‡¶§‡ßà‡¶∞‡¶ø‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º: ${currentDate}\n-----------------------------------\nüí∞ ‡¶∏‡ßç‡¶¨‡¶∞‡ßç‡¶£‡ßá‡¶∞ ‡¶¶‡¶æ‡¶Æ: ‡ß≥${customValue} ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶≠‡¶∞‡¶ø\n‡¶™‡¶∞‡¶ø‡¶£‡¶§ ‡¶Æ‡¶æ‡¶®: ${finalVori} ‡¶≠‡¶∞‡¶ø, ${finalAna} ‡¶Ü‡¶®‡¶æ, ${finalRotti} ‡¶∞‡¶§‡ßç‡¶§‡¶ø, ${receiptPoint} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü\n‚ú® ‡¶ì‡¶ú‡¶®: ${gramResult.toFixed(3)} ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ\nüî® ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶≠‡¶∞‡¶ø‡¶∞ ‡¶Æ‡¶ú‡ßÅ‡¶∞‡¶ø: ‡ß≥${optionalValue.toFixed(2)}\nüíµ ‡¶Æ‡ßã‡¶ü ‡¶Æ‡¶ú‡ßÅ‡¶∞‡¶ø: ‡ß≥${totalWage.toFixed(2)}\n-----------------------------------\n${finalResultText}\n-----------------------------------\n‚úÖ ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶!`;
        }

        function downloadReceipt() {
            buildReceipt();
            const blob = new Blob([receiptContent], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Gold_Receipt_${new Date().getTime()}.txt`;
            link.click();
        }

        async function copyReceipt() {
            buildReceipt();
            await navigator.clipboard.writeText(receiptContent);
            alert("‚úÖ ‡¶∞‡¶∏‡¶ø‡¶¶ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
        }

        async function shareReceipt() {
            buildReceipt();
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: "Charigram Gold Market",
                        text: receiptContent
                    });
                } catch (err) {
                    alert("‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
                }
            } else {
                alert("‚ùå ‡¶è‡¶á ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶∞‡ßç‡¶•‡¶® ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ!");
            }
        }
    </script>
</body>
</html>
